\usepackage[explicit]{titlesec}
\setcounter{secnumdepth}{4}
\renewcommand{\chaptertitlename}{Chương}
\DeclareFixedFont{\chapternumberfont}{T5}{phv}{b}{sc}{1in}
\DeclareFixedFont{\bigsf}{T5}{ugq}{b}{n}{35pt}
\DeclareFixedFont{\chapternamefont}{T5}{ugq}{b}{n}{18pt}
%%%Hộp chương mục


\titlespacing*{\chapter}{0pt}{-2.2cm}{1cm}
\titleformat{\chapter}
{\color{white}\bigsf}
{\begin{tcolorbox}[
		enhanced jigsaw,
		before skip =6pt, after skip= 6pt,
		colback=\mycolor!40,colframe=\mycolor!70!black,
		arc=0pt,halign upper=left,
		%	empty,opacityback=0
		left=6cm, right=2.2cm, top=1cm, bottom=1cm,
		grow to right by= 2.1cm,
		grow to left by= 2.1cm,
		title={\Large Chuyên đề 20},
		boxed title style={empty},
		attach boxed title to top left={xshift=1.5cm, yshift=-2mm},
		overlay unbroken and first={%
			\path (frame.north west) coordinate (A)
			(frame.south west) coordinate (B)
			(frame.north east) coordinate (D)
			(frame.south east) coordinate (C);
			\path (title.north west) coordinate (At)
			(title.south west) coordinate (Bt)
			(title.north east) coordinate (Dt)
			(title.south east) coordinate (Ct)
			;
			%		 
			\path [fill=\mycolor!50!black] (Dt)--([yshift=2mm]Ct)--++(15pt,0)--cycle;
			\path[fill=\mycolor!60,draw=\mycolor] let \p1=($([yshift=-2.25cm]Bt)-([yshift=-2.25cm]Ct)$) in
			([yshift=-2.25cm]Ct) arc (360:180:{veclen(\x1,\y1)/2})
			([yshift=-2.25cm]Bt)--(At)--(Dt)--([yshift=-2.25cm]Ct)
			;
			\path[fill=\mycolor!90!black] let \p1=($([yshift=-2.25cm]Bt)-([yshift=-2.25cm]Ct)$) in
			($([yshift=-2.25cm]Ct)!0.5!([yshift=-2.25cm]Bt)$) circle ({veclen(\x1,\y1)/2*0.9});
			\path[fill=\mycolor!10] let \p1=($([yshift=-2.25cm]Bt)-([yshift=-2.25cm]Ct)$) in
			($([yshift=-2.25cm]Ct)!0.5!([yshift=-2.25cm]Bt)$) circle ({veclen(\x1,\y1)/2*0.85});
			\path ([yshift=-5pt]$(At)!0.5!(Ct)$) node[font=\color{\maunhan!50!black}\chapternamefont] {\chaptertitlename};
			\path ($([yshift=-2.25cm]Ct)!0.5!([yshift=-2.25cm]Bt)$) node [font=\color{\maunhan!50!black}\chapternumberfont]{\thechapter};
		}
		]
		\color{\maunhan!50!black}\bigsf \MakeUppercase{#1}
\end{tcolorbox}}
{5ex minus .1ex}
{}
[
\vspace{-0.5cm}
\thispagestyle{empty}
]

%\titleformat{\chapter}[display]
%{\color{white}\bigsf}
%{\begin{tikzpicture}[declare function ={d=8pt;}]
%	\node[minimum width=\textwidth-1.0cm,font=\fontsize{40pt}{4pt}\selectfont\color{white},anchor= center,text width =\linewidth-3.25cm,inner sep =8pt](tieudechuong) {\MakeUppercase{#1}};
%	\path (tieudechuong.north west) coordinate (A1)
%	(tieudechuong.north east) coordinate (B1)
%	(tieudechuong.south east) coordinate (C1)
%	(tieudechuong.south west) coordinate (D1)
%	;
%	\path (tieudechuong.north west)--++(135:d) coordinate (A2)
%	(tieudechuong.north east)--++(45:d) coordinate (B2)
%	(tieudechuong.south east)--++(-45:d) coordinate (C2)
%	(tieudechuong.south west)--++(-135:d) coordinate (D2)
%	;
%	\fill[\mycolor,rounded corners=8pt] (A2)--(B2)--(C2)--(D2)--cycle;
%	\draw[rounded corners=4pt,white,line width =2pt] (A1)--(B1)--(C1)--(D1)--cycle;
%	\node[minimum width=\textwidth-1.0cm,font=\color{white}\bigsf,anchor= center,text width =\linewidth-3.25cm,inner sep =8pt](tieude) at (tieudechuong) {\MakeUppercase{#1}};
%	\path ([xshift =-1.8cm,yshift=0.5cm]B1) node[fill=\mycolor!60,rounded corners=3pt,minimum size =2.0cm,font =\chapternumberfont,anchor = center] (sochuong) {\thechapter};
%	\path(sochuong.west) node[font =\color{\mycolor}\chapternamefont,anchor = south east,yshift=-.3cm] (chuong) {\chaptertitlename};
%\end{tikzpicture}}
%{1ex minus .1ex}
%{}
%[
%\vspace{-0.5cm}
%\thispagestyle{empty}
%]
%%%============================Định dạng section==================================%%%%%%%%%%%%
 \renewcommand{\thesection}{\arabic{section}}
 \newtcolorbox{sectionbox}[1]{%
 	before skip=6pt,after skip= 6pt,
 	enhanced, skin=enhancedlast jigsaw,
 	arc is angular, halign=center,
 	fonttitle=\fontfamily{qag}\selectfont\bfseries,
 	fontupper=\color{\maunhan!50!black}\bigsf,
 	attach boxed title to top left={xshift=-4mm,yshift=-0.5mm},
 	colbacktitle=\mycolor!50!black, colframe=\maunhan!50!black,
 	colback=white,
 	boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt},
 	underlay boxed title={
 		\fill[\mycolor!45!white!50!black] ([yshift=-0.5mm]frame.north west)
 		-- +(-0.4,0) -- +(0,-0.3) -- cycle;
 		\fill[\mycolor!45!white!50!black] ([yshift=-0.5mm]frame.north east)
 		-- +(0,-0.3) -- +(0.4,0) -- cycle; 
 		\path[fill=\mycolor] (title.north west) -- (title.north east) coordinate (A)
 		-- +(\tcboxedtitleheight-1mm,-\tcboxedtitleheight+0.75mm) coordinate (B)
 		-- ([xshift=4mm,yshift=0.5mm]frame.north east) -- +(0mm,-1mm)
 		-- (title.south west) -- cycle;
 		\foreach \mau/\xt in {80/2,60/6,50/10,40/14,35/18}
 		\path[fill=\mycolor!\mau,transform canvas={xshift=\xt pt}] (A)--(B)--([xshift=2pt]B)--([xshift=2pt]A)--cycle;
 	},
 	title={\faDiamond\, #1}
 }
 \titlespacing*{\section}{0pt}{1cm}{0.5cm}
 \titleformat{\section}
 {}
 {\begin{sectionbox}{\thesection}
 		#1
 \end{sectionbox}}
 {0pt}
 {}[\vspace{-0.5cm}] 
%%%===========================subsection===============%%%
\titlespacing*{\subsection}{3pt}{-10pt}{0pt}
\titleformat{\subsection}
  {}
  {%
 \begin{tikzpicture}
 \path (0,0) node[align=left,anchor=west,font=\Large\sffamily\bfseries\color{white},text width=0.95\linewidth](SEC){#1};
 \path (SEC.north west) coordinate (A)
	 (SEC.south west) coordinate (B)
	 ($ (A)+(-1pt,-3pt) $)  coordinate (At)
	 ($ (B)+(-1pt,3pt) $)  coordinate (Bt)
	 ($(At)!1!90:(Bt)$) coordinate (Dt)
	 ($(Bt)!1!-90:(At)$) coordinate (Ct)
	 ($ (Ct)!0.5!(Dt) $) coordinate (E)
	  ($ (Ct)!0.5!(At) $) coordinate (AC)
	 ;
  \draw[line width=1pt,\mycolor!55!black,rounded corners=3pt] (A) rectangle ($(B)+(0.975\linewidth,0) $);
  \fill[rounded corners=2pt,fill=\mycolor!80!black] ($ (At)+(-3pt,0) $) rectangle (Ct); 
  \fill[rounded corners=2pt,fill=\mycolor] (At) rectangle (Ct);
   \path ([shift={(-45:1pt)}]AC) node[inner sep=0pt,font=\large\bfseries\color{gray}]{\Alph{subsection}};
   \path (AC) node[inner sep=0pt,font=\large\bfseries\color{white}]{\Alph{subsection}};  
   \path ([shift={(-45:0.65pt)}]E) node[align=left,anchor=west,font=\large\sffamily\bfseries\color{gray},text width=0.95\linewidth]{#1};
   \path (E) node[align=left,anchor=west,font=\large\sffamily\bfseries\color{\mycolor!75!black},text width=0.95\linewidth]{#1};
  \end{tikzpicture}%
  }%
  {0pt}
  {}
   %%%===========================subsubsection===============%%%
   \renewcommand{\thesubsubsection}{\Roman{subsubsection}}
   \titlespacing*{\subsubsection}{3pt}{.5cm}{0pt}
   \titleformat{\subsubsection}
   {}
   {%
   	\begin{tikzpicture}[remember picture]
   		\path (0,0) 
   		node [\mycolor,minimum height= .8cm,font=\bfseries \fontfamily{qag}\selectfont](Sub)%
   		{\thesubsubsection};
   		\path
   		(Sub.north west)coordinate (B)
   		(Sub.south east)coordinate (C)
   		(Sub.west)coordinate (D)
   		(Sub.east)coordinate (E)
   		($ (D)+(3pt,0) $) coordinate (D1)
   		($ (E)+(3pt,0) $) coordinate (E1)
   		;
   		\fill[\mycolor!40] (B)--(Sub.north east)--(E1)--(C)--(Sub.south west)--cycle 
   		;
   		\path ($ (Sub.east)+(1pt,0) $) 
   		node [\mycolor,minimum height= .8cm,inner sep=3pt,anchor=west,font=\bfseries \fontfamily{qag}\selectfont](Muc)%
   		%{\arabic{subsection}.\;\MakeUppercase{#1}};
   		{#1};
   		\path
   		(Muc.north west)coordinate (Bt)
   		(Muc.south east)coordinate (Ct)
   		(Muc.west)coordinate (Dt)
   		(Muc.east)coordinate (Et)
   		($ (Dt)+(3pt,0) $) coordinate (D1t)
   		($ (Et)+(3pt,0) $) coordinate (E1t)
   		;
   		\fill[\mycolor!20] (D1t)--(Bt)--(Muc.north east)--(E1t)--(Ct)--(Muc.south west)--cycle 
   		;
   		\path (0,0) 
   		node [\mycolor!50!black,font=\bfseries\fontfamily{qag}\selectfont]
   		{\thesubsubsection};
   		\path ($ (Sub.east)+(1pt,0) $) 
   		node [\mycolor!50!black,anchor= west,font=\bfseries \fontfamily{qag}\selectfont]{#1};
   	\end{tikzpicture}}
   {3pt}{}
   
  
 %%%==========================================================%%%
\titlespacing*{\paragraph}{0cm}{0pt}{0pt}
\titleformat{\paragraph}
{}
{\color{\mycolor!90!black}\bfseries\fontfamily{qag}\selectfont\circlenumH[\mycolor!50!black]{\arabic{paragraph}}\;\bfseries\fontfamily{qag}\selectfont{#1}}
{0.5ex minus .2ex}
{}
{}
%%%==========================================================%%%
     
     
  %%%=====================Muc luc============================%%%
  \usepackage{titletoc}
  \patchcmd{\tableofcontents}{\contentsname}{\bfseries\sffamily\contentsname}{}{}
  \makeatletter
  \newif\ifnotstarredversion
  \renewcommand{\numberline}[1]{#1.~}
  \renewcommand{\thechapter}{\arabic{chapter}}
  \renewcommand*\l@chapter[2]{%
      \ifnum \c@tocdepth >-2\relax
      \addpenalty{-\@highpenalty}%
      \addvspace{10pt \@plus\p@}%
      \setlength\@tempdima{3em}%
      \begingroup
     \tikz[remember picture]{
  	\path (0,0) coordinate (A)--(\linewidth,0) coordinate (B);%
  	\path ($ (A)!0.5!(B) $) node[font=\bfseries\sffamily\large,align=center,text width=\linewidth] (TEXT)
  	{{Chương~#1 - Trang~#2}};
  	 \fill[dnvang!65!black,rounded corners=3.5pt] ([xshift=-2pt]TEXT.north west) rectangle ([xshift=2pt]TEXT.south east);
  	 \fill[dnvang!15,rounded corners=3pt] ([yshift=0.15pt]TEXT.north west) rectangle ([yshift=-0.15pt]TEXT.south east);
  	 \hypersetup{linkcolor=dnvang!85!black}
  	 \path ($ (A)!0.5!(B) $) node[font=\bfseries\sffamily\large\color{\mycolor!85!black},align=center,text width=\linewidth] (TEXT)
  		{{Chương~#1 - Trang~#2}};
  	}
      \par\bigskip
  	\penalty\@highpenalty
  	\setcounter{section}{0}
      \endgroup
      \fi
  }
  \makeatother
  
  \renewcommand{\thesection}{Bài \arabic{section}}
  \titlecontents{section}
    [1.5cm]
    {\hypersetup{linkcolor=black}\vspace*{0.15\baselineskip}\sffamily\bfseries{\thecontentslabel\;}}{}{}
    {\titlerule*[0.65pc]{.}\thecontentspage}
  
  \renewcommand{\thesubsection}{\Alph{subsection})}
  \titlecontents{subsection}
    [2.85cm]
    {\hypersetup{linkcolor=black}\bfseries\sffamily\vspace*{-0.15\baselineskip}{\thecontentslabel\;}}{}{}  
    {\titlerule*[1pc]{.}\thecontentspage}
    
  \renewcommand{\thesubsubsection}{\Roman{subsubsection}.}
  \titlecontents{subsubsection}
  [2.85cm]
  {\hypersetup{linkcolor=black}\bfseries\sffamily\vspace*{-0.15\baselineskip}{\thecontentslabel\;}}{}{}  
  {\titlerule*[1pc]{.}\thecontentspage}
  \makeatletter
  \renewcommand{\tableofcontents}{%
  \newpage
  \markboth{Mục lục}{Mục lục}
%  \renewcommand{\rightmark}{Mục lục}
  \begin{center}
  	\begin{tcolorbox}[enhanced,hbox,
  			left=8mm,right=8mm,boxrule=0.55pt,
  			bottom=3pt,
  			colback=white,colframe=dnvang,
  			%drop fuzzy midday shadow=black!50!yellow,
  			drop lifted shadow=black!50!yellow,arc is angular,
  			before=\par\vspace*{-1mm},after=\par\bigskip]
  			{\bfseries\Large\color{dnvang}\sffamily MỤC LỤC} 
  		\end{tcolorbox}
  \end{center}
  \newcounter{somucluc}
  \vskip-1.25cm
  \@starttoc{toc}}
  \makeatother